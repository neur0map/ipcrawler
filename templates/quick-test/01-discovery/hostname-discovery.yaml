metadata:
  name: "Quick Hostname Discovery"
  description: "Fast hostname discovery using dig for reverse DNS lookups"
  type: "portscan"
  priority: 0
  version: "1.0"
  author: "IPCrawler Quick Test Template"
  tags:
    - quick
    - discovery
    - dns

conditions:
  # Run for all targets - no service filtering needed for hostname discovery
  services:
    include: []
  protocols:
    include: ["tcp", "udp"]

options:
  - name: "timeout"
    type: "integer"
    default: 10
    help: "DNS lookup timeout in seconds"
  - name: "nameserver"
    type: "string"
    default: "8.8.8.8"
    help: "DNS nameserver to use for lookups"

execution:
  commands:
    - name: "reverse_dns_lookup"
      command: "dig +time={timeout} @{nameserver} -x {address} +short || echo 'No reverse DNS record found for {address}'"
      timeout: 30
      output_file: "_hostname_discovery.txt"
    
    - name: "basic_dns_info"
      command: "echo 'Target: {address}' && echo 'DNS Lookup timestamp: $(date)' && nslookup {address} {nameserver} 2>/dev/null | grep -v '^$' || echo 'No DNS information available'"
      timeout: 15
      output_file: "_dns_info.txt"

output:
  patterns:
    - pattern: "([a-zA-Z0-9\\-\\.]+\\.[a-zA-Z]{2,})\\s*$"
      description: "Hostname discovered: {match1}"
      severity: "info"
      category: "hostname_discovery"
    
    - pattern: "(?i)no reverse dns|no dns information"
      description: "No hostname resolution available for target"
      severity: "info"
      category: "hostname_discovery"
    
    - pattern: "(?i)timeout|network unreachable"
      description: "DNS lookup timeout or network issue"
      severity: "low"
      category: "network_issues"

  technology_detection:
    - pattern: "(?i)([a-zA-Z0-9\\-]+)\\.(?:amazonaws\\.com|cloudfront\\.net)"
      technology: "AWS"
    - pattern: "(?i)([a-zA-Z0-9\\-]+)\\.(?:azurewebsites\\.net|azure\\.com)"
      technology: "Azure"
    - pattern: "(?i)([a-zA-Z0-9\\-]+)\\.(?:googleapis\\.com|gcp\\.)"
      technology: "Google Cloud"

requirements:
  tools:
    - name: "dig"
      check_command: "dig -v"
      install_hint: "apt-get install dnsutils"
    - name: "nslookup"
      check_command: "nslookup -version"
      install_hint: "apt-get install dnsutils"

debug:
  log_level: "info"
  trace_decisions: true
  show_command_output: false

variables:
  timeout: 10
  nameserver: "8.8.8.8"