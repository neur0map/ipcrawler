metadata:
  name: "WordPress Security Scanner"
  description: "Comprehensive WordPress vulnerability scanning including themes, plugins, users, and core vulnerabilities"
  author: "IPCrawler YAML Plugin System"
  version: "1.0.0"
  type: "servicescan"
  slug: "wpscan"
  priority: 4
  references:
    - "https://wpscan.com/"
    - "https://github.com/wpscanteam/wpscan"

conditions:
  services_include:
    - "^http"
    - "ssl/http"
    - "^https"
  services_exclude:
    - "^nacn_http$"

commands:
  - description: "WordPress detection and basic scan"
    command: "wpscan --url {url} --detection-mode aggressive --output {scandir}/wpscan-basic-{port}.json --format json"
    timeout: 300

  - description: "WordPress theme vulnerability scan"
    command: "wpscan --url {url} --enumerate t --detection-mode aggressive --output {scandir}/wpscan-themes-{port}.json --format json"
    timeout: 300

  - description: "WordPress plugin vulnerability scan"
    command: "wpscan --url {url} --enumerate p --detection-mode aggressive --output {scandir}/wpscan-plugins-{port}.json --format json"
    timeout: 600

  - description: "WordPress user enumeration"
    command: "wpscan --url {url} --enumerate u --detection-mode aggressive --output {scandir}/wpscan-users-{port}.json --format json"
    timeout: 300

  - description: "WordPress comprehensive scan"
    command: "wpscan --url {url} --enumerate ap,at,cb,dbe --detection-mode aggressive --output {scandir}/wpscan-comprehensive-{port}.json --format json"
    timeout: 900

  - description: "WordPress config backup detection"
    command: "wpscan --url {url} --enumerate cb --detection-mode aggressive --output {scandir}/wpscan-backups-{port}.json --format json"
    timeout: 180

  - description: "WordPress database export detection"
    command: "wpscan --url {url} --enumerate dbe --detection-mode aggressive --output {scandir}/wpscan-database-{port}.json --format json"
    timeout: 180

patterns:
  - description: "WordPress Installation Detected"
    pattern: "WordPress.*version.*[0-9]+\\.[0-9]+|wp-content|wp-includes"
    category: "wordpress_detection"
    severity: "info"

  - description: "WordPress Version Detected"
    pattern: "WordPress.*version.*([0-9]+\\.[0-9]+\\.[0-9]+)"
    category: "version_info"
    severity: "medium"

  - description: "Outdated WordPress Core"
    pattern: "WordPress.*version.*outdated|core.*vulnerabilities.*found"
    category: "outdated_core"
    severity: "high"

  - description: "WordPress Admin User Found"
    pattern: "user.*admin.*found|username.*admin"
    category: "admin_user"
    severity: "medium"

  - description: "WordPress User Enumeration"
    pattern: "user.*id.*[0-9]+.*username"
    category: "user_enumeration"
    severity: "medium"

  - description: "Vulnerable WordPress Plugin"
    pattern: "plugin.*vulnerabilities.*found|plugin.*version.*outdated"
    category: "vulnerable_plugin"
    severity: "high"

  - description: "Vulnerable WordPress Theme"
    pattern: "theme.*vulnerabilities.*found|theme.*version.*outdated"
    category: "vulnerable_theme"
    severity: "high"

  - description: "WordPress Config Backup Found"
    pattern: "wp-config.*backup.*found|configuration.*backup"
    category: "config_backup"
    severity: "critical"

  - description: "WordPress Database Export Found"
    pattern: "database.*export.*found|sql.*dump.*found"
    category: "database_export"
    severity: "critical"

  - description: "WordPress Login Protection Bypass"
    pattern: "login.*protection.*bypass|authentication.*bypass"
    category: "auth_bypass"
    severity: "critical"

  - description: "WordPress XML-RPC Enabled"
    pattern: "XML-RPC.*enabled|xmlrpc.*php.*found"
    category: "xmlrpc_enabled"
    severity: "medium"

  - description: "WordPress Debug Log Found"
    pattern: "debug.*log.*found|wp-content.*debug"
    category: "debug_log"
    severity: "medium"

  - description: "WordPress Upload Directory Accessible"
    pattern: "uploads.*directory.*accessible|wp-content.*uploads"
    category: "uploads_accessible"
    severity: "medium"

  - description: "WordPress Brute Force Protection"
    pattern: "brute.*force.*protection.*detected"
    category: "brute_force_protection"
    severity: "info"

  - description: "WordPress Firewall Detected"
    pattern: "firewall.*detected|WAF.*detected"
    category: "firewall_detected"
    severity: "info"

  - description: "WordPress Multisite Installation"
    pattern: "multisite.*installation|WordPress.*MU"
    category: "multisite"
    severity: "info"

  - description: "WordPress Secret Keys Missing"
    pattern: "secret.*keys.*not.*defined|authentication.*keys.*missing"
    category: "missing_secrets"
    severity: "medium"

  - description: "WordPress File Permissions Issue"
    pattern: "file.*permissions.*issue|directory.*permissions"
    category: "permission_issue"
    severity: "medium"

  - description: "WordPress SQL Injection"
    pattern: "SQL.*injection.*vulnerability|database.*injection"
    category: "sql_injection"
    severity: "critical"

  - description: "WordPress Cross-Site Scripting"
    pattern: "XSS.*vulnerability|cross.*site.*scripting"
    category: "xss"
    severity: "high"

  - description: "WordPress Cross-Site Request Forgery"
    pattern: "CSRF.*vulnerability|cross.*site.*request.*forgery"
    category: "csrf"
    severity: "medium"

  - description: "WordPress Remote Code Execution"
    pattern: "RCE.*vulnerability|remote.*code.*execution"
    category: "rce"
    severity: "critical"

  - description: "WordPress Local File Inclusion"
    pattern: "LFI.*vulnerability|local.*file.*inclusion"
    category: "lfi"
    severity: "high"

  - description: "WordPress Remote File Inclusion"
    pattern: "RFI.*vulnerability|remote.*file.*inclusion"
    category: "rfi"
    severity: "critical"

  - description: "WordPress Privilege Escalation"
    pattern: "privilege.*escalation.*vulnerability"
    category: "privilege_escalation"
    severity: "high"

  - description: "WordPress Information Disclosure"
    pattern: "information.*disclosure.*vulnerability"
    category: "info_disclosure"
    severity: "medium"

  - description: "WordPress Plugin Directory Listing"
    pattern: "plugin.*directory.*listing|wp-content.*plugins.*index"
    category: "directory_listing"
    severity: "medium"

  - description: "WordPress Theme Directory Listing"
    pattern: "theme.*directory.*listing|wp-content.*themes.*index"
    category: "directory_listing"
    severity: "medium"

  - description: "WordPress Backup Plugin Data"
    pattern: "backup.*plugin.*data|backup.*files.*found"
    category: "backup_data"
    severity: "high"

  - description: "WordPress Timthumb Vulnerability"
    pattern: "timthumb.*vulnerability|timthumb.*version.*outdated"
    category: "timthumb_vuln"
    severity: "high"

  - description: "WordPress WP-Admin Directory Accessible"
    pattern: "wp-admin.*directory.*accessible"
    category: "admin_accessible"
    severity: "medium"

  - description: "WordPress REST API Exposed"
    pattern: "REST.*API.*exposed|wp-json.*accessible"
    category: "rest_api"
    severity: "medium"