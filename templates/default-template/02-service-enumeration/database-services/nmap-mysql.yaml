metadata:
  name: Nmap MySQL Enumeration
  description: MySQL database enumeration using comprehensive nmap scripts
  type: servicescan
  priority: 5
  version: '1.0'
  author: IPCrawler YAML Plugin System
conditions:
  services:
    include:
    - ^mysql
options:
- name: min_rate
  type: integer
  default: 5000
  help: Minimum packet rate per second
- name: max_rate
  type: integer
  default: 10000
  help: Maximum packet rate per second
- name: timing_template
  type: choice
  choices:
  - T1
  - T2
  - T3
  - T4
  - T5
  default: T5
  help: Nmap timing template
execution:
  commands:
  - name: nmap_mysql_enumeration
    command: nmap -{timing_template} --min-rate={min_rate} --max-rate={max_rate}
      -sV -p {port} --script="banner,(mysql* or ssl*) and not (brute or broadcast
      or dos or external or fuzzer)" -oN "{scandir}/{protocol}_{port}_mysql_nmap.txt"
      -oX "{scandir}/xml/{protocol}_{port}_mysql_nmap.xml" {address}
    timeout: 600
    output_file: '{protocol}_{port}_mysql_nmap.txt'
  manual_commands:
  - description: (nmap) MySQL enumeration with scripts
    command: nmap -T5 -sV -p {port} --script="mysql*" {address}
  - description: (nmap) MySQL info and version
    command: nmap -p {port} --script mysql-info,mysql-variables {address}
  - description: (mysql) Interactive MySQL client
    command: mysql -h {address} -P {port} -u root -p
  - description: (sqsh) Interactive database shell
    command: sqsh -U <username> -P <password> -S {address}:{port}
output:
  patterns:
  - pattern: (?i)mysql.*version[:\s]*([^\n\r]+)
    description: 'MySQL Version: {match1}'
    severity: info
    category: version
  - pattern: (?i)mysql.*([\d\.]+)
    description: MySQL Database v{match1} detected - check for known vulnerabilities
    severity: info
    category: technology
  - pattern: (?i)mariadb.*([\d\.]+)
    description: MariaDB v{match1} detected - MySQL-compatible database
    severity: info
    category: technology
  - pattern: (?i)percona.*([\d\.]+)
    description: Percona Server v{match1} detected - MySQL-compatible database
    severity: info
    category: technology
  - pattern: (?i)database[s]?[:\s]*([^\n\r]+)
    description: 'MySQL Databases: {match1}'
    severity: medium
    category: enumeration
  - pattern: (?i)schema[s]?[:\s]*([^\n\r]+)
    description: 'MySQL Schemas: {match1}'
    severity: medium
    category: enumeration
  - pattern: (?i)table[s]?[:\s]*([^\n\r]+)
    description: 'MySQL Tables: {match1}'
    severity: medium
    category: enumeration
  - pattern: (?i)user[s]?[:\s]*([^\n\r]+)
    description: 'MySQL Users: {match1}'
    severity: high
    category: enumeration
  - pattern: (?i)root.*user.*found
    description: MySQL root user detected
    severity: medium
    category: authentication
  - pattern: (?i)anonymous.*access.*enabled
    description: 'CRITICAL: MySQL anonymous access enabled'
    severity: critical
    category: security
  - pattern: (?i)empty.*password.*detected
    description: 'CRITICAL: MySQL user with empty password detected'
    severity: critical
    category: security
  - pattern: (?i)weak.*password.*detected
    description: 'HIGH: MySQL weak password detected'
    severity: high
    category: security
  - pattern: (?i)ssl.*enabled
    description: MySQL SSL/TLS enabled - encrypted connections supported
    severity: info
    category: security
  - pattern: (?i)ssl.*disabled
    description: 'WARNING: MySQL SSL/TLS disabled - unencrypted connections'
    severity: medium
    category: security
  - pattern: (?i)remote.*root.*login.*enabled
    description: 'CRITICAL: MySQL remote root login enabled'
    severity: critical
    category: security
  - pattern: (?i)file.*privileges.*enabled
    description: 'HIGH: MySQL FILE privileges enabled - potential file system access'
    severity: high
    category: security
  - pattern: (?i)version[:\s]*([^\n\r]+)
    description: 'MySQL Server Version: {match1}'
    severity: info
    category: version
  - pattern: (?i)datadir[:\s]*([^\n\r]+)
    description: 'MySQL Data Directory: {match1}'
    severity: low
    category: configuration
  - pattern: (?i)basedir[:\s]*([^\n\r]+)
    description: 'MySQL Base Directory: {match1}'
    severity: low
    category: configuration
  - pattern: (?i)hostname[:\s]*([^\n\r]+)
    description: 'MySQL Hostname: {match1}'
    severity: info
    category: identification
  - pattern: (?i)bind.*address[:\s]*([^\n\r]+)
    description: 'MySQL Bind Address: {match1}'
    severity: info
    category: network
  - pattern: (?i)skip.*networking.*enabled
    description: MySQL networking disabled - local connections only
    severity: info
    category: security
  - pattern: (?i)privilege.*escalation.*possible
    description: 'CRITICAL: MySQL privilege escalation vulnerability detected'
    severity: critical
    category: vulnerability
  - pattern: (?i)access.*denied.*for.*user
    description: MySQL access denied - authentication required
    severity: info
    category: authentication
  - pattern: (?i)too.*many.*connections
    description: MySQL connection limit reached
    severity: low
    category: availability
  - pattern: (?i)server.*shutdown.*in.*progress
    description: MySQL server shutting down
    severity: low
    category: availability
  - pattern: (?i)innodb.*enabled
    description: MySQL InnoDB storage engine enabled
    severity: info
    category: configuration
  - pattern: (?i)myisam.*enabled
    description: MySQL MyISAM storage engine enabled
    severity: info
    category: configuration
  - pattern: (?i)mysql.*5\.0\.[0-4]
    description: 'CRITICAL: MySQL 5.0.0-5.0.4 detected - multiple known vulnerabilities'
    severity: critical
    category: vulnerability
  - pattern: (?i)mysql.*5\.1\.[0-2]
    description: 'HIGH: MySQL 5.1.0-5.1.2 detected - known vulnerabilities'
    severity: high
    category: vulnerability
  - pattern: (?i)udf.*injection.*possible
    description: 'CRITICAL: MySQL UDF injection vulnerability detected'
    severity: critical
    category: vulnerability
  - pattern: (?i)backup.*file.*found
    description: MySQL backup file detected - potential data exposure
    severity: medium
    category: data_exposure
  - pattern: (?i)mysqldump.*accessible
    description: MySQL dump utility accessible
    severity: medium
    category: tools
  - pattern: (?i)slave.*status[:\s]*([^\n\r]+)
    description: 'MySQL Slave Status: {match1}'
    severity: info
    category: replication
  - pattern: (?i)master.*status[:\s]*([^\n\r]+)
    description: 'MySQL Master Status: {match1}'
    severity: info
    category: replication
  technology_detection:
  - pattern: (?i)mysql.*([\d\.]+)
    technology: MySQL
    version_group: 1
  - pattern: (?i)mariadb.*([\d\.]+)
    technology: MariaDB
    version_group: 1
  - pattern: (?i)percona.*server.*([\d\.]+)
    technology: Percona Server
    version_group: 1
requirements:
  tools:
  - name: nmap
    check_command: nmap --version
    install_hint: apt-get install nmap
debug:
  log_level: info
  trace_decisions: false
  show_command_output: false
variables:
  min_rate: 1000
  max_rate: 5000
  timing_template: T4
