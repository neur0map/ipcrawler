metadata:
  name: "CTF & HackTheBox Pattern Detection"
  description: "Specialized detection patterns for CTF environments, HackTheBox machines, and competitive hacking platforms"
  author: "IPCrawler YAML Plugin System"
  version: "1.0.0"
  type: "servicescan"
  slug: "ctf-htb-patterns"
  priority: 3
  references:
    - "https://www.hackthebox.eu/"
    - "https://ctftime.org/"
    - "https://overthewire.org/wargames/"

conditions:
  services_include:
    - "^http"
    - "ssl/http"
    - "^https"
    - "^ssh"
    - "^ftp"
    - "^unknown$"
  services_exclude:
    - "^nacn_http$"

commands:
  - description: "CTF flag pattern detection"
    command: "curl -sSik http://{address}:{port}/ | grep -i 'flag\\|ctf\\|thm\\|htb'"
    timeout: 30

  - description: "Common CTF directories"
    command: "curl -sSik http://{address}:{port}/flag.txt"
    timeout: 15

  - description: "CTF challenge indicators"
    command: "curl -sSik http://{address}:{port}/robots.txt | grep -i 'flag\\|secret\\|admin\\|hidden'"
    timeout: 15

  - description: "Source code disclosure patterns"
    command: "curl -sSik http://{address}:{port}/index.php.bak"
    timeout: 15

  - description: "Common backup files"
    command: "curl -sSik http://{address}:{port}/backup.zip"
    timeout: 15

  - description: "Git repository exposure"
    command: "curl -sSik http://{address}:{port}/.git/config"
    timeout: 15

  - description: "Environment files"
    command: "curl -sSik http://{address}:{port}/.env"
    timeout: 15

  - description: "Configuration files"
    command: "curl -sSik http://{address}:{port}/config.php"
    timeout: 15

  - description: "Common CTF admin panels"
    command: "curl -sSik http://{address}:{port}/admin/"
    timeout: 15

  - description: "Debug endpoints"
    command: "curl -sSik http://{address}:{port}/debug"
    timeout: 15

  - description: "PHPInfo exposure"
    command: "curl -sSik http://{address}:{port}/phpinfo.php"
    timeout: 15

  - description: "Server status pages"
    command: "curl -sSik http://{address}:{port}/server-status"
    timeout: 15

patterns:
  - description: "HTB Flag Format"
    pattern: "HTB\\{[a-zA-Z0-9_]+\\}"
    category: "flag"
    severity: "critical"

  - description: "TryHackMe Flag Format"
    pattern: "THM\\{[a-zA-Z0-9_]+\\}"
    category: "flag"
    severity: "critical"

  - description: "Generic CTF Flag Format"
    pattern: "(flag|FLAG)\\{[^}]+\\}"
    category: "flag"
    severity: "critical"

  - description: "CTF Challenge Indicator"
    pattern: "(challenge|Challenge|CHALLENGE).*\\{.*\\}"
    category: "challenge"
    severity: "high"

  - description: "Common Flag Pattern"
    pattern: "[a-f0-9]{32}|[a-f0-9]{40}|[a-f0-9]{64}"
    category: "potential_flag"
    severity: "medium"

  - description: "Base64 Encoded Flag"
    pattern: "[A-Za-z0-9+/]{20,}={0,2}"
    category: "encoded_data"
    severity: "medium"

  - description: "SQL Injection Hint"
    pattern: "(union|UNION).*select|'.*or.*1=1|admin.*password"
    category: "sql_injection"
    severity: "high"

  - description: "Command Injection Hint"
    pattern: ";.*ls|\\|.*cat|`.*whoami|system\\(|exec\\("
    category: "command_injection"
    severity: "high"

  - description: "XSS Vulnerability Hint"
    pattern: "<script>.*alert|document\\.cookie|javascript:"
    category: "xss"
    severity: "medium"

  - description: "Directory Traversal Hint"
    pattern: "\\.\\./.*passwd|\\.\\./.*shadow|\\.\\./.*hosts"
    category: "directory_traversal"
    severity: "high"

  - description: "Exposed Backup Files"
    pattern: "\\.bak|\\.backup|\\.old|\\.orig|\\.tmp"
    category: "backup_exposure"
    severity: "medium"

  - description: "Source Code Exposure"
    pattern: "\\.(php|asp|aspx|jsp)\\.bak|source.*code"
    category: "source_exposure"
    severity: "high"

  - description: "Git Repository Exposure"
    pattern: "\\[core\\].*repositoryformatversion|\\[remote.*origin"
    category: "git_exposure"
    severity: "high"

  - description: "Environment Variables"
    pattern: "DB_PASSWORD|API_KEY|SECRET_KEY|PRIVATE_KEY"
    category: "credential_exposure"
    severity: "critical"

  - description: "Database Credentials"
    pattern: "mysql://|postgres://|mongodb://.*password"
    category: "database_credential"
    severity: "critical"

  - description: "JWT Token"
    pattern: "eyJ[A-Za-z0-9-_]+\\."
    category: "jwt_token"
    severity: "medium"

  - description: "SSH Private Key"
    pattern: "BEGIN.*PRIVATE.*KEY|ssh-rsa|ssh-dss"
    category: "ssh_key"
    severity: "critical"

  - description: "Password Hash"
    pattern: "\\$2[aby]\\$|\\$5\\$|\\$6\\$|\\{SSHA\\}"
    category: "password_hash"
    severity: "medium"

  - description: "CTF Platform Indicator"
    pattern: "hackthebox|tryhackme|overthewire|picoctf|ctftime"
    category: "ctf_platform"
    severity: "info"

  - description: "Common CTF Services"
    pattern: "nc.*port|netcat.*listen|socat.*exec"
    category: "ctf_service"
    severity: "medium"

  - description: "Web Shell"
    pattern: "<?php.*eval|<?php.*system|c99.*shell|r57.*shell"
    category: "web_shell"
    severity: "critical"

  - description: "Reverse Shell"
    pattern: "/bin/bash.*-i|nc.*-e.*sh|python.*socket"
    category: "reverse_shell"
    severity: "critical"

  - description: "SUID Binary Hint"
    pattern: "-rwsr-xr-x|chmod.*4755|find.*-perm.*4000"
    category: "privilege_escalation"
    severity: "high"

  - description: "Sudo Misconfiguration"
    pattern: "sudo.*NOPASSWD|\\(ALL\\).*ALL"
    category: "privilege_escalation"
    severity: "high"

  - description: "Cron Job Exposure"
    pattern: "\\*/[0-9]+.*\\*.*\\*.*\\*.*root"
    category: "scheduled_task"
    severity: "medium"

  - description: "Docker Escape Hint"
    pattern: "docker.*sock|/var/run/docker|--privileged"
    category: "container_escape"
    severity: "high"

  - description: "Kernel Exploit Hint"
    pattern: "uname.*-a|/proc/version|exploit.*kernel"
    category: "kernel_exploit"
    severity: "high"

  - description: "Binary Exploitation Hint"
    pattern: "buffer.*overflow|ret2libc|ROP.*chain"
    category: "binary_exploitation"
    severity: "high"

  - description: "Steganography Hint"
    pattern: "steghide|stego|hidden.*message|binwalk"
    category: "steganography"
    severity: "medium"

  - description: "Cryptography Challenge"
    pattern: "decrypt|cipher|encode|decode|crypto"
    category: "cryptography"
    severity: "medium"

  - description: "OSINT Challenge"
    pattern: "metadata|exif|geolocation|social.*engineering"
    category: "osint"
    severity: "low"

  - description: "Forensics Challenge"
    pattern: "memory.*dump|pcap.*file|volatility|wireshark"
    category: "forensics"
    severity: "medium"

  - description: "Web Exploitation Framework"
    pattern: "exploit.*db|metasploit|burp.*suite|sqlmap"
    category: "exploitation_tool"
    severity: "medium"

  - description: "CTF Scoring System"
    pattern: "scoreboard|ranking|points.*earned|team.*score"
    category: "ctf_system"
    severity: "info"