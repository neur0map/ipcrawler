metadata:
  name: "SSL Scan"
  description: "SSL/TLS configuration analysis with certificate examination"
  type: "servicescan"
  priority: 5
  version: "1.0"
  author: "IPCrawler YAML Plugin System"

conditions:
  services:
    include: [".*"]  # Match all services
  ssl_required: true  # Only run on SSL/TLS services

options:
  - name: "show_certificate"
    type: "boolean"
    default: true
    help: "Show certificate details in output"
  - name: "no_colour"
    type: "boolean"
    default: true
    help: "Disable colored output for better parsing"

execution:
  commands:
    - name: "sslscan_analysis"
      command: "sslscan --show-certificate --no-colour {addressv6}:{port} 2>&1"
      timeout: 300
      output_file: "{protocol}_{port}_sslscan.txt"
      condition: "protocol == 'tcp' and ssl_required"

  manual_commands:
    - description: "SSL/TLS comprehensive analysis with certificate details"
      command: "sslscan --show-certificate {address}:{port}"
    - description: "SSL/TLS cipher suite enumeration"
      command: "sslscan --no-failed {address}:{port}"

output:
  patterns:
    # SSL/TLS Version Information
    - pattern: "(?i)SSL\\s+Version:\\s+([^\\n\\r]+)"
      description: "SSL Version: {match1}"
      severity: "info"
      category: "version"
    
    - pattern: "(?i)TLS\\s+Version:\\s+([^\\n\\r]+)"
      description: "TLS Version: {match1}"
      severity: "info"
      category: "version"
    
    # Cipher Suite Information
    - pattern: "(?i)Accepted\\s+([^\\s]+)\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "Accepted Cipher: {match1} {match2} - {match3}"
      severity: "info"
      category: "cipher"
    
    - pattern: "(?i)Rejected\\s+([^\\s]+)\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "Rejected Cipher: {match1} {match2} - {match3}"
      severity: "info"
      category: "cipher"
    
    # Weak Ciphers and Protocols
    - pattern: "(?i)SSLv2\\s+enabled"
      description: "CRITICAL: SSLv2 enabled - extremely insecure protocol"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)SSLv3\\s+enabled"
      description: "CRITICAL: SSLv3 enabled - vulnerable to POODLE attack"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)TLSv1\\.0\\s+enabled"
      description: "WARNING: TLSv1.0 enabled - deprecated protocol"
      severity: "high"
      category: "security"
    
    - pattern: "(?i)TLSv1\\.1\\s+enabled"
      description: "WARNING: TLSv1.1 enabled - deprecated protocol"
      severity: "medium"
      category: "security"
    
    - pattern: "(?i)TLSv1\\.2\\s+enabled"
      description: "TLSv1.2 enabled - acceptable security"
      severity: "info"
      category: "security"
    
    - pattern: "(?i)TLSv1\\.3\\s+enabled"
      description: "TLSv1.3 enabled - excellent security"
      severity: "info"
      category: "security"
    
    # Weak Cipher Suites
    - pattern: "(?i)NULL"
      description: "CRITICAL: NULL cipher detected - no encryption"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)RC4"
      description: "CRITICAL: RC4 cipher detected - cryptographically broken"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)DES"
      description: "CRITICAL: DES cipher detected - weak encryption"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)3DES"
      description: "HIGH: 3DES cipher detected - deprecated encryption"
      severity: "high"
      category: "security"
    
    - pattern: "(?i)MD5"
      description: "HIGH: MD5 hash detected - cryptographically broken"
      severity: "high"
      category: "security"
    
    - pattern: "(?i)SHA1"
      description: "MEDIUM: SHA1 hash detected - weak hashing"
      severity: "medium"
      category: "security"
    
    # Certificate Information
    - pattern: "(?i)Certificate:\\s+([^\\n\\r]+)"
      description: "SSL Certificate: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Subject:\\s+([^\\n\\r]+)"
      description: "Certificate Subject: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Issuer:\\s+([^\\n\\r]+)"
      description: "Certificate Issuer: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Valid\\s+from:\\s+([^\\n\\r]+)"
      description: "Certificate Valid From: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Valid\\s+to:\\s+([^\\n\\r]+)"
      description: "Certificate Valid To: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Serial\\s+Number:\\s+([^\\n\\r]+)"
      description: "Certificate Serial: {match1}"
      severity: "info"
      category: "certificate"
    
    - pattern: "(?i)Signature\\s+Algorithm:\\s+([^\\n\\r]+)"
      description: "Certificate Signature Algorithm: {match1}"
      severity: "info"
      category: "certificate"
    
    # Certificate Warnings
    - pattern: "(?i)self\\s+signed"
      description: "WARNING: Self-signed certificate detected"
      severity: "medium"
      category: "certificate"
    
    - pattern: "(?i)certificate\\s+expired"
      description: "CRITICAL: Certificate expired"
      severity: "critical"
      category: "certificate"
    
    - pattern: "(?i)certificate\\s+not\\s+yet\\s+valid"
      description: "CRITICAL: Certificate not yet valid"
      severity: "critical"
      category: "certificate"
    
    - pattern: "(?i)hostname\\s+mismatch"
      description: "HIGH: Certificate hostname mismatch"
      severity: "high"
      category: "certificate"
    
    # Key Information
    - pattern: "(?i)Public\\s+Key:\\s+([^\\n\\r]+)"
      description: "Public Key: {match1}"
      severity: "info"
      category: "key"
    
    - pattern: "(?i)RSA\\s+Public\\s+Key:\\s+([^\\s]+)\\s+bit"
      description: "RSA Public Key: {match1} bits"
      severity: "info"
      category: "key"
    
    - pattern: "(?i)RSA\\s+.*512\\s+bit"
      description: "CRITICAL: 512-bit RSA key - extremely weak"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)RSA\\s+.*1024\\s+bit"
      description: "HIGH: 1024-bit RSA key - weak by modern standards"
      severity: "high"
      category: "security"
    
    - pattern: "(?i)RSA\\s+.*2048\\s+bit"
      description: "RSA 2048-bit key - acceptable security"
      severity: "info"
      category: "security"
    
    - pattern: "(?i)RSA\\s+.*4096\\s+bit"
      description: "RSA 4096-bit key - strong security"
      severity: "info"
      category: "security"
    
    # Perfect Forward Secrecy
    - pattern: "(?i)ECDHE"
      description: "Perfect Forward Secrecy: ECDHE key exchange"
      severity: "info"
      category: "security"
    
    - pattern: "(?i)DHE"
      description: "Perfect Forward Secrecy: DHE key exchange"
      severity: "info"
      category: "security"
    
    # Vulnerabilities
    - pattern: "(?i)POODLE"
      description: "CRITICAL: POODLE vulnerability detected"
      severity: "critical"
      category: "vulnerability"
    
    - pattern: "(?i)BEAST"
      description: "HIGH: BEAST vulnerability detected"
      severity: "high"
      category: "vulnerability"
    
    - pattern: "(?i)CRIME"
      description: "HIGH: CRIME vulnerability detected"
      severity: "high"
      category: "vulnerability"
    
    - pattern: "(?i)BREACH"
      description: "MEDIUM: BREACH vulnerability detected"
      severity: "medium"
      category: "vulnerability"
    
    - pattern: "(?i)Heartbleed"
      description: "CRITICAL: Heartbleed vulnerability detected"
      severity: "critical"
      category: "vulnerability"
    
    # Connection Information
    - pattern: "(?i)Connected\\s+to\\s+([^\\n\\r]+)"
      description: "Connected to: {match1}"
      severity: "info"
      category: "connection"
    
    - pattern: "(?i)Testing\\s+SSL\\s+server\\s+([^\\n\\r]+)"
      description: "Testing SSL server: {match1}"
      severity: "info"
      category: "connection"

  technology_detection:
    - pattern: "(?i)openssl\\s+([\\d\\.]+)"
      technology: "OpenSSL"
      version_group: 1
    
    - pattern: "(?i)apache\\s+([\\d\\.]+)"
      technology: "Apache"
      version_group: 1
    
    - pattern: "(?i)nginx\\s+([\\d\\.]+)"
      technology: "Nginx"
      version_group: 1

requirements:
  tools:
    - name: "sslscan"
      check_command: "sslscan --version"
      install_hint: "apt-get install sslscan"

debug:
  log_level: "info"
  trace_decisions: false
  show_command_output: false