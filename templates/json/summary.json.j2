{
  "metadata": {
    "target": "{{ metadata.target }}",
    "start_time": "{{ metadata.start_time }}",
    "end_time": "{{ metadata.end_time }}",
    "duration_seconds": {{ metadata.duration_seconds }},
    "output_directory": "{{ metadata.output_directory }}",
    "config_used": "{{ metadata.config_used }}"
  },
  "execution_stats": {
    "total_tools": {{ execution_stats.total_tools }},
    "successful_tools": {{ execution_stats.successful_tools }},
    "failed_tools": {{ execution_stats.failed_tools }},
    "tools_with_output": {{ execution_stats.tools_with_output }},
    "total_output_size": {{ execution_stats.total_output_size }}
  },
  "discoveries": [
    {%- for discovery in discoveries %}
    {
      "type": "{{ discovery.discovery_type.type }}",
      "value": "{{ discovery.value }}",
      "confidence": {{ discovery.confidence }},
      "detected_by": "{{ discovery.detected_by }}",
      "detection_pattern": "{{ discovery.detection_pattern }}",
      "timestamp": "{{ discovery.timestamp }}",
      "metadata": {{ discovery.metadata | tojson }}
    }{% if not loop.last %},{% endif %}
    {%- endfor %}
  ],
  "discoveries_by_type": {
    {%- for type_name, type_discoveries in discoveries_by_type.items() %}
    "{{ type_name }}": [
      {%- for discovery in type_discoveries %}
      {
        "value": "{{ discovery.value }}",
        "confidence": {{ discovery.confidence }},
        "detected_by": "{{ discovery.detected_by }}"
      }{% if not loop.last %},{% endif %}
      {%- endfor %}
    ]{% if not loop.last %},{% endif %}
    {%- endfor %}
  },
  "raw_outputs": {
    {%- for tool_name, output in raw_outputs.items() %}
    "{{ tool_name }}": {
      "stdout_size": {{ output.size_bytes }},
      "stderr_length": {{ output.stderr | length }},
      "parsed_success": {{ output.parsed_success | lower }},
      "parsing_errors": {{ output.parsing_errors | tojson }},
      "file_paths": {{ output.file_paths | tojson }}
    }{% if not loop.last %},{% endif %}
    {%- endfor %}
  },
  "parsing_metadata": {
    "patterns_used": {{ parsing_metadata.patterns_used | tojson }},
    "total_lines_processed": {{ parsing_metadata.total_lines_processed }},
    "successful_extractions": {{ parsing_metadata.successful_extractions }},
    "failed_extractions": {{ parsing_metadata.failed_extractions }},
    "parser_version": "{{ parsing_metadata.parser_version }}",
    "parsing_timestamp": "{{ parsing_metadata.parsing_timestamp }}"
  },
  "tool_results": [
    {%- for result in tool_results %}
    {
      "name": "{{ result.name }}",
      "exit_code": {{ result.exit_code }},
      "duration_seconds": {{ result.duration_seconds }},
      "has_output": {{ result.has_output | lower }},
      "output_size": {{ result.output_size }},
      "error_message": {% if result.error_message %}"{{ result.error_message }}"{% else %}null{% endif %}
    }{% if not loop.last %},{% endif %}
    {%- endfor %}
  ],
  "failed_tools": [
    {%- for failure in failed_tools %}
    {
      "name": "{{ failure.name }}",
      "exit_code": {{ failure.exit_code }},
      "error": "{{ failure.error }}",
      "suggested_fix": {% if failure.suggested_fix %}"{{ failure.suggested_fix }}"{% else %}null{% endif %}
    }{% if not loop.last %},{% endif %}
    {%- endfor %}
  ],
  "summary": {
    "ports_discovered": {{ ports_count }},
    "services_discovered": {{ services_count }},
    "total_discoveries": {{ discoveries | length }},
    "scan_success_rate": {{ (execution_stats.successful_tools / execution_stats.total_tools * 100) | round(1) }}
  },
  "generated_at": "{{ template_generated_at }}"
}