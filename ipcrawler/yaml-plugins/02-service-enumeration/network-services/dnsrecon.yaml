metadata:
  name: "DnsRecon Default Scan"
  description: "DNS enumeration using dnsrecon with comprehensive record analysis"
  type: "servicescan"
  priority: 0
  version: "1.0"
  author: "IPCrawler YAML Plugin System"

conditions:
  services:
    include: ["^domain"]

options:
  - name: "domain"
    type: "string"
    default: ""
    help: "Target domain name for DNS enumeration"
    required: true

execution:
  commands:
    - name: "dnsrecon_default"
      command: "dnsrecon -n {address} -d {domain} 2>&1"
      timeout: 300
      output_file: "{protocol}_{port}_dnsrecon_default.txt"
      condition: "domain != ''"

  manual_commands:
    - description: "Use dnsrecon to automatically query data from the DNS server. You must specify the target domain name."
      command: "dnsrecon -n {address} -d <DOMAIN-NAME> 2>&1 | tee {scandir}/{protocol}_{port}_dnsrecon_default_manual.txt"

output:
  patterns:
    # DNS Record Types
    - pattern: "(?i)\\[\\*\\]\\s*A\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS A Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*AAAA\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS AAAA Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*CNAME\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS CNAME Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*MX\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS MX Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*NS\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS NS Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*PTR\\s+([^\\s]+)\\s+([^\\s]+)"
      description: "DNS PTR Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*SOA\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "DNS SOA Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*SRV\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "DNS SRV Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    - pattern: "(?i)\\[\\*\\]\\s*TXT\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "DNS TXT Record: {match1} -> {match2}"
      severity: "info"
      category: "dns_record"
    
    # DNS Zone Transfer
    - pattern: "(?i)zone\\s+transfer\\s+successful"
      description: "CRITICAL: DNS Zone Transfer successful - zone information disclosed"
      severity: "critical"
      category: "security"
    
    - pattern: "(?i)zone\\s+transfer\\s+failed"
      description: "DNS Zone Transfer failed - properly secured"
      severity: "info"
      category: "security"
    
    # DNS Server Information
    - pattern: "(?i)\\[\\*\\]\\s*Performing\\s+General\\s+Enumeration\\s+of\\s+Domain:\\s+([^\\n\\r]+)"
      description: "DNS Domain Enumeration: {match1}"
      severity: "info"
      category: "enumeration"
    
    - pattern: "(?i)\\[\\*\\]\\s*NS\\s+Server\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "DNS Name Server: {match1} ({match2})"
      severity: "info"
      category: "infrastructure"
    
    - pattern: "(?i)\\[\\*\\]\\s*Mail\\s+Server\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "Mail Server: {match1} ({match2})"
      severity: "info"
      category: "infrastructure"
    
    # DNS Brute Force Results
    - pattern: "(?i)\\[\\*\\]\\s*Brute\\s+Force\\s+([^\\s]+)\\s+([^\\n\\r]+)"
      description: "DNS Brute Force Result: {match1} -> {match2}"
      severity: "info"
      category: "brute_force"
    
    # DNS Wildcards
    - pattern: "(?i)wildcard\\s+resolution\\s+is\\s+enabled"
      description: "DNS Wildcard resolution enabled"
      severity: "info"
      category: "configuration"
    
    - pattern: "(?i)wildcard\\s+resolution\\s+is\\s+disabled"
      description: "DNS Wildcard resolution disabled"
      severity: "info"
      category: "configuration"
    
    # DNS Cache Snooping
    - pattern: "(?i)cache\\s+snooping\\s+possible"
      description: "WARNING: DNS Cache Snooping possible - information disclosure risk"
      severity: "medium"
      category: "security"
    
    # DNS Version Information
    - pattern: "(?i)\\[\\*\\]\\s*([^\\s]+)\\s+has\\s+([^\\n\\r]+)"
      description: "DNS Server Info: {match1} - {match2}"
      severity: "info"
      category: "version"
    
    # Error Conditions
    - pattern: "(?i)connection\\s+refused"
      description: "DNS connection refused"
      severity: "low"
      category: "error"
    
    - pattern: "(?i)timeout\\s+error"
      description: "DNS query timeout"
      severity: "low"
      category: "error"
    
    - pattern: "(?i)no\\s+answer"
      description: "DNS query returned no answer"
      severity: "info"
      category: "error"

  technology_detection:
    - pattern: "(?i)bind\\s+([\\d\\.]+)"
      technology: "BIND"
      version_group: 1
    
    - pattern: "(?i)microsoft\\s+dns\\s+([\\d\\.]+)"
      technology: "Microsoft DNS"
      version_group: 1
    
    - pattern: "(?i)powerdns\\s+([\\d\\.]+)"
      technology: "PowerDNS"
      version_group: 1

requirements:
  tools:
    - name: "dnsrecon"
      check_command: "dnsrecon --version"
      install_hint: "apt-get install dnsrecon"
  
  global_options:
    - name: "domain"
      description: "Target domain name for DNS enumeration"
      required: true

debug:
  log_level: "info"
  trace_decisions: false
  show_command_output: false