# JSON Schema for tools.yaml validation
$schema: "http://json-schema.org/draft-07/schema#"
title: "Tool Configuration Schema"
description: "Schema for validating tool registry configurations"
type: "object"
required: ["tools"]

properties:
  tools:
    type: "object"
    minProperties: 1
    patternProperties:
      "^[a-zA-Z][a-zA-Z0-9_-]*$":  # Tool names must start with letter
        type: "object"
        required: ["name", "command"]
        properties:
          name:
            type: "string"
            minLength: 1
            maxLength: 100
            description: "Human-readable tool name"
            
          command:
            type: "string"
            minLength: 1
            maxLength: 100
            pattern: "^[a-zA-Z0-9_.-]+$"  # Valid command names
            description: "Command to execute"
            
          patterns:
            type: "array"
            items:
              $ref: "#/definitions/pattern"
            description: "Tool-specific parsing patterns"
            
          install:
            $ref: "#/definitions/install_instructions"
            description: "Installation instructions per platform"
    additionalProperties: false
    
  generic_patterns:
    type: "array"
    items:
      $ref: "#/definitions/pattern"
    description: "Patterns that apply to multiple tools"

definitions:
  pattern:
    type: "object"
    required: ["name", "regex", "type"]
    properties:
      name:
        type: "string"
        minLength: 1
        maxLength: 100
        pattern: "^[a-zA-Z][a-zA-Z0-9_-]*$"
        description: "Unique pattern identifier"
        
      regex:
        type: "string"
        minLength: 1
        maxLength: 1000
        description: "Regular expression pattern"
        # Note: We don't validate regex syntax in schema, done in code
        
      type:
        type: "string"
        enum: ["port", "service", "vulnerability", "directory", "custom"]
        description: "Type of discovery this pattern matches"
        
      confidence:
        type: "number"
        minimum: 0.0
        maximum: 1.0
        default: 0.8
        description: "Confidence level of pattern matches"
    additionalProperties: false
    
  install_instructions:
    type: "object"
    properties:
      generic:
        type: "string"
        minLength: 1
        description: "Generic installation command"
        
      macos:
        type: "string"
        minLength: 1
        description: "macOS-specific installation"
        
      ubuntu:
        type: "string" 
        minLength: 1
        description: "Ubuntu-specific installation"
        
      fedora:
        type: "string"
        minLength: 1
        description: "Fedora-specific installation"
        
      windows:
        type: "string"
        minLength: 1
        description: "Windows-specific installation"
    additionalProperties: false
    minProperties: 1  # At least one install method required

additionalProperties: false

# Example validation rules (checked in code):
# - Regex patterns must compile successfully
# - Tool commands should exist in PATH or provide install instructions
# - Pattern names must be unique across all patterns
# - Confidence values should be reasonable (0.1-1.0)